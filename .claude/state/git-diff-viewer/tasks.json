{
  "prd": {
    "name": "Git Diff Viewer",
    "source": "docs/prd/git-diff-viewer.md",
    "createdAt": "2026-01-25T10:38:50Z"
  },
  "tasks": [
    {
      "id": "task-001",
      "category": "setup",
      "title": "Add git type definitions",
      "description": "Create TypeScript interfaces for git-related data structures including GitCommit, FileDiff, DiffHunk, and DiffLine. Extend existing TaskLog interface to include optional commits array.",
      "steps": [
        "Create app/types/git.ts with GitCommit, FileDiff, DiffHunk, DiffLine interfaces",
        "Add commits?: string[] field to TaskLog interface in app/types/task.ts",
        "Export new types from app/types/index.ts"
      ],
      "passes": [
        "GitCommit interface has sha, shortSha, message, author, date, filesChanged, additions, deletions fields",
        "FileDiff interface has path, status, oldPath, additions, deletions fields",
        "DiffHunk interface has oldStart, oldLines, newStart, newLines, lines fields",
        "DiffLine interface has type, content, oldNumber, newNumber fields",
        "TaskLog interface includes optional commits array",
        "TypeScript compiles without errors"
      ],
      "dependencies": [],
      "priority": "critical",
      "status": "completed",
      "startedAt": "2026-01-25T10:43:40Z",
      "completedAt": "2026-01-25T10:44:40Z"
    },
    {
      "id": "task-002",
      "category": "setup",
      "title": "Create git utility functions",
      "description": "Create server-side utilities for executing git commands using child_process.spawn. Include functions for getting commit info, file diffs, and commit diffs with proper error handling and output parsing.",
      "steps": [
        "Create server/utils/git.ts",
        "Implement execGit helper function using spawn with proper error handling",
        "Implement getCommitInfo(repoPath, sha) to get commit details",
        "Implement getCommitDiff(repoPath, sha) to get list of changed files with stats",
        "Implement getFileDiff(repoPath, sha, filePath) to get hunks for a specific file",
        "Implement isGitRepo(path) check",
        "Add path validation to prevent traversal attacks"
      ],
      "passes": [
        "execGit correctly spawns git process and captures output",
        "getCommitInfo returns parsed GitCommit object",
        "getCommitDiff returns array of FileDiff objects with addition/deletion counts",
        "getFileDiff returns array of DiffHunk objects with line-by-line changes",
        "isGitRepo returns true for git repos, false otherwise",
        "Path validation rejects paths outside repo root",
        "Errors are handled gracefully with descriptive messages"
      ],
      "dependencies": ["task-001"],
      "priority": "critical",
      "status": "completed",
      "startedAt": "2026-01-25T10:46:06Z",
      "completedAt": "2026-01-25T10:47:47Z"
    },
    {
      "id": "task-003",
      "category": "feature",
      "title": "Create git API endpoints",
      "description": "Create Nuxt server API endpoints for fetching git commit information and diffs. Endpoints should validate repo access and handle errors gracefully.",
      "steps": [
        "Create GET /api/repos/[repoId]/git/commits.get.ts - fetch commit details by SHA(s)",
        "Create GET /api/repos/[repoId]/git/diff.get.ts - get file list with stats for a commit",
        "Create GET /api/repos/[repoId]/git/file-diff.get.ts - get hunks for specific file in commit",
        "Add isGitRepo check and return appropriate error if not a git repo",
        "Validate query parameters (sha, file path)"
      ],
      "passes": [
        "GET /commits?shas=sha1,sha2 returns array of GitCommit objects",
        "GET /diff?commit=sha returns array of FileDiff objects",
        "GET /file-diff?commit=sha&file=path returns DiffHunk array",
        "Non-git repos return 400 with helpful error message",
        "Invalid SHAs return 404",
        "Invalid file paths return 404",
        "Endpoints work with repos configured via repo selector"
      ],
      "dependencies": ["task-002"],
      "priority": "critical",
      "status": "completed",
      "startedAt": "2026-01-25T10:48:53Z",
      "completedAt": "2026-01-25T10:49:50Z"
    },
    {
      "id": "task-004",
      "category": "feature",
      "title": "Create useGit composable",
      "description": "Create a Vue composable for fetching git data from the API endpoints. Include functions for fetching commits, diffs, and file-specific diffs with loading and error states.",
      "steps": [
        "Create app/composables/useGit.ts",
        "Implement fetchCommits(repoId, shas[]) function",
        "Implement fetchDiff(repoId, commitSha) function",
        "Implement fetchFileDiff(repoId, commitSha, filePath) function",
        "Add loading and error state management",
        "Handle API errors with toast notifications"
      ],
      "passes": [
        "fetchCommits returns array of GitCommit objects",
        "fetchDiff returns array of FileDiff objects for a commit",
        "fetchFileDiff returns DiffHunk array for specific file",
        "Loading states are reactive and accurate",
        "API errors trigger toast notifications",
        "Functions handle missing/invalid data gracefully"
      ],
      "dependencies": ["task-003"],
      "priority": "high",
      "status": "completed",
      "startedAt": "2026-01-25T10:50:47Z",
      "completedAt": "2026-01-25T10:51:26Z"
    },
    {
      "id": "task-005",
      "category": "feature",
      "title": "Create CommitList component",
      "description": "Create a component to display a list of commits associated with a task. Shows commit SHA, message, author, date, and file change summary.",
      "steps": [
        "Create app/components/git/CommitList.vue",
        "Accept commits array prop (SHA strings) and repoId prop",
        "Fetch commit details using useGit composable",
        "Display each commit with short SHA, message (truncated), author, relative date",
        "Show file count and +/- stats per commit",
        "Emit select event when commit is clicked",
        "Add loading skeleton while fetching"
      ],
      "passes": [
        "Component renders list of commits with all required info",
        "Short SHA displayed as monospace font",
        "Commit messages truncated appropriately",
        "Dates shown in relative format (e.g., '2 hours ago')",
        "Click on commit emits select event with SHA",
        "Loading state shows skeleton placeholder",
        "Empty state handled when no commits"
      ],
      "dependencies": ["task-004"],
      "priority": "high",
      "status": "completed",
      "startedAt": "2026-01-25T10:52:42Z",
      "completedAt": "2026-01-25T10:53:45Z"
    },
    {
      "id": "task-006",
      "category": "feature",
      "title": "Create ChangesMinimap component",
      "description": "Create a visual minimap component showing all changed files with proportional colored bars representing additions (green) and deletions (red). Supports file selection for navigation.",
      "steps": [
        "Create app/components/git/ChangesMinimap.vue",
        "Accept files (FileDiff[]) and selectedFile props",
        "Display file paths in a vertical scrollable list",
        "Render colored bar for each file: green portion for additions, red for deletions",
        "Calculate bar proportions based on max changes across all files",
        "Highlight currently selected file",
        "Emit select event when file is clicked",
        "Show file status icon (added/modified/deleted/renamed)"
      ],
      "passes": [
        "Component renders all files in vertical list",
        "Each file shows colored bar with correct green/red proportions",
        "Bar widths are proportional to change volume relative to largest change",
        "Selected file is visually highlighted",
        "Click on file emits select event with file path",
        "File status shown with appropriate icon/color",
        "Scrollable when many files",
        "Handles renamed files showing old → new path"
      ],
      "dependencies": ["task-004"],
      "priority": "high",
      "status": "completed",
      "startedAt": "2026-01-25T10:55:25Z",
      "completedAt": "2026-01-25T10:56:10Z"
    },
    {
      "id": "task-007",
      "category": "feature",
      "title": "Create DiffViewer component with side-by-side layout",
      "description": "Create the main diff viewer component with side-by-side layout showing old and new file content with syntax highlighting. Display line numbers and highlight additions/deletions.",
      "steps": [
        "Create app/components/git/DiffViewer.vue",
        "Accept hunks (DiffHunk[]) and filePath props for syntax detection",
        "Render two-column layout: left for old content, right for new content",
        "Display line numbers in gutters",
        "Use shiki for syntax highlighting based on file extension",
        "Style added lines with green background, removed with red",
        "Show context lines in neutral color",
        "Handle line number gaps between hunks with separator"
      ],
      "passes": [
        "Two-column layout displays old (left) and new (right) content",
        "Line numbers shown in gutters",
        "Syntax highlighting applied based on file type",
        "Added lines have green background",
        "Removed lines have red background",
        "Context lines have neutral background",
        "Hunk separators shown between non-contiguous sections",
        "Supports both light and dark themes"
      ],
      "dependencies": ["task-004"],
      "priority": "critical",
      "status": "completed",
      "startedAt": "2026-01-25T10:57:29Z",
      "completedAt": "2026-01-25T10:59:25Z"
    },
    {
      "id": "task-008",
      "category": "feature",
      "title": "Create DiffPanel container component",
      "description": "Create a container component that combines ChangesMinimap and DiffViewer into a cohesive diff viewing experience. Manages file selection state and data fetching.",
      "steps": [
        "Create app/components/git/DiffPanel.vue",
        "Accept repoId and commitSha props",
        "Fetch commit diff (file list) on mount",
        "Manage selectedFile state, default to first file",
        "Fetch file diff when selectedFile changes",
        "Layout: minimap sidebar (left, ~200px), diff viewer (right, flex)",
        "Pass data to child components",
        "Add loading and error states"
      ],
      "passes": [
        "Component fetches file list on mount",
        "First file auto-selected by default",
        "Clicking file in minimap updates diff viewer",
        "File diff fetched when selection changes",
        "Layout shows minimap on left, diff on right",
        "Loading spinner while fetching",
        "Error state with retry option"
      ],
      "dependencies": ["task-006", "task-007"],
      "priority": "high",
      "status": "completed",
      "startedAt": "2026-01-25T11:00:46Z",
      "completedAt": "2026-01-25T11:01:56Z"
    },
    {
      "id": "task-009",
      "category": "integration",
      "title": "Integrate diff viewer into TaskDetail panel",
      "description": "Add a 'Changes' section to the TaskDetail component that shows commits associated with a task and allows viewing diffs. Only show for tasks that have commits recorded.",
      "steps": [
        "Read progress.json to get taskLogs with commits",
        "Add API endpoint to fetch task commits if needed",
        "Add 'Changes' section to Detail.vue below existing content",
        "Conditionally render section only if task has commits",
        "Show CommitList for task's commits",
        "On commit select, open DiffPanel in expanded view or modal",
        "Handle transition between commit list and diff view"
      ],
      "passes": [
        "Changes section only appears for tasks with commits array",
        "CommitList displays commits from taskLog.commits",
        "Clicking commit opens diff panel",
        "Can navigate back from diff view to commit list",
        "Section hidden for tasks without commits",
        "Works within the existing Sheet component layout"
      ],
      "dependencies": ["task-005", "task-008"],
      "priority": "high",
      "status": "completed",
      "startedAt": "2026-01-25T11:03:10Z",
      "completedAt": "2026-01-25T11:05:26Z"
    },
    {
      "id": "task-010",
      "category": "integration",
      "title": "Add API endpoint for task commits lookup",
      "description": "Create an API endpoint that returns commits for a specific task by looking up the taskLogs in progress.json.",
      "steps": [
        "Create GET /api/repos/[repoId]/prd/[prdSlug]/tasks/[taskId]/commits.get.ts",
        "Read progress.json for the PRD",
        "Find taskLog entry matching taskId",
        "Return commits array (empty if not found)",
        "Handle missing progress.json gracefully"
      ],
      "passes": [
        "Endpoint returns commits array for tasks with commits",
        "Returns empty array for tasks without commits",
        "Handles missing progress.json with empty response",
        "Returns 404 for invalid taskId",
        "Works with existing repo/prd routing structure"
      ],
      "dependencies": ["task-001"],
      "priority": "medium",
      "status": "completed",
      "startedAt": "2026-01-25T11:11:05Z",
      "completedAt": "2026-01-25T11:12:14Z"
    },
    {
      "id": "task-011",
      "category": "integration",
      "title": "Update complete-next-task skill to capture commits",
      "description": "Modify the /complete-next-task skill to automatically capture the commit SHA after committing and store it in the task's commits array in progress.json.",
      "steps": [
        "Edit .claude/skills/complete-next-task/skill.md",
        "After step 9 (commit), add step to capture commit SHA using git rev-parse HEAD",
        "Update the taskLog entry to include commits array with the new SHA",
        "Handle case where multiple commits are made (prompt user or auto-detect)",
        "Document the new behavior in skill description"
      ],
      "passes": [
        "Skill captures commit SHA after successful commit",
        "SHA stored in taskLogs[].commits array in progress.json",
        "Works with single commit workflow",
        "Handles edge case of no new commits gracefully",
        "Skill documentation updated to reflect new behavior"
      ],
      "dependencies": ["task-001"],
      "priority": "high",
      "status": "completed",
      "startedAt": "2026-01-25T11:07:10Z",
      "completedAt": "2026-01-25T11:08:05Z"
    },
    {
      "id": "task-012",
      "category": "feature",
      "title": "Add synchronized scrolling to diff viewer",
      "description": "Implement synchronized scrolling between the left and right panels of the side-by-side diff viewer so both panels stay aligned.",
      "steps": [
        "Add scroll event listeners to both panels",
        "Calculate scroll position relative to content height",
        "Sync opposite panel to matching position",
        "Prevent scroll event loops with flag",
        "Handle different content heights gracefully",
        "Add option to toggle sync on/off"
      ],
      "passes": [
        "Scrolling left panel syncs right panel",
        "Scrolling right panel syncs left panel",
        "No infinite scroll loops occur",
        "Panels stay aligned at equivalent positions",
        "Toggle button to enable/disable sync",
        "Smooth scrolling behavior"
      ],
      "dependencies": ["task-007"],
      "priority": "medium",
      "status": "completed",
      "startedAt": "2026-01-25T11:16:58Z",
      "completedAt": "2026-01-25T11:18:43Z"
    },
    {
      "id": "task-013",
      "category": "feature",
      "title": "Handle edge cases in diff viewer",
      "description": "Add handling for edge cases including binary files, large files, renamed files, and empty diffs.",
      "steps": [
        "Detect binary files in git diff output",
        "Show 'Binary file' placeholder instead of diff for binary files",
        "Add file size check and truncation for large files (>10000 lines)",
        "Show 'Show more' button for truncated files",
        "Display renamed files with old → new path indicator",
        "Handle empty diffs (file touched but no changes)"
      ],
      "passes": [
        "Binary files show 'Binary file changed' message",
        "Large files truncated with line count indicator",
        "'Show more' loads additional content",
        "Renamed files show both old and new paths",
        "Empty diffs show appropriate message",
        "No crashes or errors for edge cases"
      ],
      "dependencies": ["task-007"],
      "priority": "medium",
      "status": "completed",
      "startedAt": "2026-01-25T11:20:05Z",
      "completedAt": "2026-01-25T11:22:46Z"
    },
    {
      "id": "task-014",
      "category": "feature",
      "title": "Add keyboard navigation for diff viewer",
      "description": "Add keyboard shortcuts for navigating between files in the minimap and scrolling through the diff.",
      "steps": [
        "Add keyboard event listeners when diff panel is focused",
        "Implement j/k or arrow keys to navigate between files",
        "Implement [ and ] to jump between hunks",
        "Implement Escape to close diff panel",
        "Show keyboard shortcuts hint in UI",
        "Ensure focus management works correctly"
      ],
      "passes": [
        "Arrow keys or j/k navigate file list",
        "[ and ] jump to previous/next hunk",
        "Escape closes the diff panel",
        "Keyboard hint shown in corner or header",
        "Focus correctly managed when opening/closing",
        "Shortcuts work with both minimap and diff viewer"
      ],
      "dependencies": ["task-008"],
      "priority": "low",
      "status": "pending"
    },
    {
      "id": "task-015",
      "category": "testing",
      "title": "Test diff viewer with real git data",
      "description": "Manually test the diff viewer functionality with real git repository data to verify all features work correctly.",
      "steps": [
        "Add test commits to a configured repository",
        "Verify CommitList displays commits correctly",
        "Test ChangesMinimap with various file counts and change sizes",
        "Verify DiffViewer renders diffs with correct highlighting",
        "Test with different file types (JS, TS, Vue, CSS, JSON, MD)",
        "Test edge cases: binary files, large files, renames",
        "Verify synchronized scrolling works",
        "Test keyboard navigation"
      ],
      "passes": [
        "Commits display with correct info (SHA, message, author, date)",
        "Minimap shows all files with proportional colored bars",
        "Side-by-side diff renders correctly with syntax highlighting",
        "Various file types highlighted appropriately",
        "Binary files show placeholder message",
        "Large files truncated with 'Show more' option",
        "Renamed files show old → new path",
        "Keyboard shortcuts work as expected"
      ],
      "dependencies": ["task-009", "task-012", "task-013", "task-014"],
      "priority": "high",
      "status": "pending"
    }
  ]
}
